<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Spring boot microservice with Kubernetes</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="spring-boot-microservice-with-kubernetes">Spring boot microservice with Kubernetes</h1>
<h3 id="kubernetes">Kubernetes:</h3>
<ul>
<li>Kubernetes, also known as K8s, is an open source system for automating deployment, scaling, and management of containerized applications.</li>
<li>It groups containers that make up an application into logical units for easy management and discovery.</li>
<li>Kubernetes builds upon 15 years of experience of running production workloads at Google, combined with best-of-breed ideas and practices from the community.</li>
<li><strong>Typical features:</strong>
<ul>
<li><em>Auto Scaling:</em>
<ul>
<li>Scale containers based on demand.</li>
</ul>
</li>
<li><em>Auto Discovery:</em>
<ul>
<li>Help microservices to find one another.</li>
</ul>
</li>
<li><em>Load Balancer:</em>
<ul>
<li>Distribute load among multiple instances of a microservice.</li>
</ul>
</li>
<li><em>Self Healing:</em>
<ul>
<li>Do health check and replace falling instances.</li>
</ul>
</li>
<li><em>Zero Downtime Deployment:</em>
<ul>
<li>Release new versions without downtime.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Docker container orchestration services:</strong>
<ul>
<li><em>AWS:</em>
<ul>
<li>Elastic Container Service (ECS)</li>
<li>Fargate:
<ul>
<li>Serverless version of ECS.</li>
</ul>
</li>
</ul>
</li>
<li><em>Cloud Neutral:</em>
<ul>
<li>Kubernetes (k8s)</li>
<li>Can be used in internal Data centers.
<ul>
<li>Also, supports all cloud platforms.
<ul>
<li>AWS   --&gt; Elastic Kubernetes Services (EKS)</li>
<li>GCP   --&gt; Google Kubernets Engine (GKE)</li>
<li>Azure --&gt; Azure Kubernetes Services (AKS)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-install-kubernetes-locallly-todo">1. Install Kubernetes locallly {TODO}</h2>
<h3 id="project-ref-na">Project ref: <em>N/A</em></h3>
<ul>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>Kubernetes on local machine.</li>
</ul>
</li>
<li>
<p><strong><ins>Steps</ins></strong></p>
<ul>
<li><em><strong>Project Setup:</strong></em> Install kubernetes locally.
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></li>
</ul>
</li>
<li><em><strong>Step-1:</strong></em> Create kubernetes cluster with default node pool.
<ul>
<li>Needs installation of <code>kubeadm</code>, <code>kind</code> or <code>minikube</code> for cluster administration.
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/">https://kubernetes.io/docs/tasks/tools/</a></li>
</ul>
</li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> TODO</li>
</ul>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/">https://kubernetes.io/docs/tasks/tools/</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="2-google-cloud---introduction-to-google-kubernetes-engine-gke">2. Google Cloud - Introduction to Google Kubernetes Engine (GKE)</h2>
<ul>
<li><strong><ins>About / Introduction</ins></strong>
<ul>
<li>Provides Kubernetes solution in cloud.</li>
<li><strong>Terms:</strong>
<ul>
<li><strong>Cluster:</strong> A group of compute engine instances.
<ul>
<li><em>Master Node:</em></li>
<li><em>Worker Nodes:</em></li>
</ul>
</li>
<li><strong>Master Node:</strong>
<ul>
<li>Also known as <code>Control plane</code> as it manages everything inside cluster. E.g. Creating new nodes or creating new deployment for a service etc.</li>
<li><code>cubectl</code> commands are execued on <code>Master Node</code>.</li>
<li>It consists of a set of components.</li>
<li><strong>Components:</strong>
<ul>
<li><em>API Server:</em>
<ul>
<li>Manages all communications for a K8S cluster (from nodes and outside).</li>
<li>When any command is executed, it is received by this component.</li>
</ul>
</li>
<li><em>Scheduler:</em>
<ul>
<li>Decides nodes for the deployment of a service.</li>
</ul>
</li>
<li><em>Controller Manager:</em>
<ul>
<li>Manages deployments and replicasets.</li>
</ul>
</li>
<li><em>etcd:</em>
<ul>
<li>A distributed dataset storing the cluster state. This information is used in providing high availability.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Worker Node:</strong>
<ul>
<li>Runs the work load. All our services (as PODs) run on worker nodes.</li>
<li><strong>Components:</strong>
<ul>
<li><em>kubelet:</em>
<ul>
<li>Manages communication with Master node(s).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Kubernetes Pods:</strong>
<ul>
<li>These are smallest deployable units in kubernetes.</li>
<li>A Pod <em>contains one or more containers</em>. However most of the Pods contains single container.</li>
<li>Each Pod is assigned an <em>ephemeral (that lasts for short duration)</em> IP address.</li>
<li>All containers in a Pods share:
<ul>
<li>Network</li>
<li>Storage</li>
<li>IP Address</li>
<li>Ports and</li>
<li>Volumes (Shared persistence disks)</li>
</ul>
</li>
<li>Pods can in any status of the following: <strong>Running / Pending / Succeeded / Failed / Unknown</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong>Deployment vs Replica set:</strong>
<ul>
<li><em>Deployment:</em>
<ul>
<li>A deployment is created for each microservice using <code>kubectl create deployment ....</code> command.
<ul>
<li>It will create a new replica set for the microservice.</li>
</ul>
</li>
<li>A single deployment represents a microservice (with all it's releases).</li>
<li>It manage new releases ensuring <code>0 downtime</code> using <code>kubectl set image deployment ....</code> command.
<ul>
<li>It will create a new replica set version for the new version of microservice.</li>
</ul>
</li>
</ul>
</li>
<li><em>Replica set:</em>
<ul>
<li>A ReplicaSet's purpose is to maintain a stable set of replica Pods running at any given time. As such, it is often used to guarantee the availability of a specified number of identical Pods.
<ul>
<li>Ensures that a specific number of Pods are running for a specific microservice version.</li>
<li>A Deployment is a higher-level concept that manages ReplicaSets and provides declarative updates to Pods along with a lot of other useful features. Therefore, we recommend using Deployments instead of directly using ReplicaSets, unless you require custom update orchestration or don't require updates at all.</li>
</ul>
</li>
<li>Automitically launches new pods if a pod goes down / killed.</li>
</ul>
</li>
<li><strong>Kubernetes Service:</strong>
<ul>
<li>Each time a new Pod is created it will have a new IP address. This could impact the external users accessing Pods with IP address.</li>
<li>To ensure that external users are not impacted even though internally IP is changed we expose service using stable service Pod / IP address.
<ul>
<li><code>kubectl expose deployment hello-world-rest-api --type=LoadBalancer --port=8080</code></li>
</ul>
</li>
<li><strong>Types:</strong>
<ul>
<li><em>Cluster IP:</em>
<ul>
<li>It exposes service on a cluster-internal IP, to access inside cluster (intra cluster communications).</li>
</ul>
</li>
<li><em>Load Balancer:</em>
<ul>
<li>It exposes service externally using a cloud provider's load balancer.</li>
<li>Check in <code>GCP load balancers</code> for all load balancers created on platform.</li>
<li>This approach work on all cloud provider kubernetes engine/service.
<ul>
<li><em>Not recommended:</em> We can also create load balancer for each micrservice.</li>
</ul>
</li>
</ul>
</li>
<li><em>Node port:</em>
<ul>
<li>It exposes service on each node's ip at a static port (the NodePort).</li>
<li><em>Use case:</em>
<ul>
<li>When we don't want to create an exernal load balancer for each micro-service. We can create one ingress component to load balance multiple microserices by routing.</li>
<li>Using ingress we can expose Pods NodePort to expose externally to outside world.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-gcp---google-cloud-with-kubernetes-hands-on">3. GCP - Google Cloud with Kubernetes [Hands-on]</h2>
<h3 id="project-ref-e1-kubernetes-deployment-with-yaml"><em><strong>Project ref:</strong></em> <em>e1-kubernetes-deployment-with-yaml</em></h3>
<ul>
<li><strong><ins>About / Introduction</ins></strong>
<ul>
<li>GCP kubernetes engine provides default node pool with 3 nodes.</li>
<li>We can add more <em>Node pools</em> with different type of hardware specification.</li>
<li><strong>Workloads:</strong>
<ul>
<li>In workloads we can see all runnin services.</li>
<li>Each running instance is called <strong>POD</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong><ins>GCP K8S project setup</ins></strong>
<ul>
<li><em><strong>Step-1:</strong></em> Create project in console <code>kubernetes-poc-1</code>.</li>
<li><em><strong>Step-2:</strong></em> Enable <code>Kubernetes API</code> in GCP platform (pop-up).</li>
<li><em><strong>Step-3:</strong></em> Create cluster and choose <code>Standard</code>.
<ul>
<li>With Autopilot, GKE provisions and manages your cluster's underlying infrastructure, including nodes and node pools, giving you an optimized cluster with a hands-off experience.</li>
<li>If you need more control over your cluster configuration, select &quot;Switch to Standard cluster.&quot;</li>
<li>Cluster Modes:
<ul>
<li>Standard:</li>
<li>Autopilot:</li>
</ul>
</li>
</ul>
</li>
<li><em><strong>Step-4:</strong></em> Fetch cluster auth data and configures cluster.
<ul>
<li><code>gcloud container clusters get-credentials my-standard-cluster-1 --zone us-central1-c --project operating-ally-446306-t7</code></li>
</ul>
</li>
<li><em><strong>Step-5:</strong></em> Deploy microservices
<ul>
<li><code>kubectl create deployment hello-world-rest-api --image=in28min/hello-world-rest-api:0.0.1.RELEASE</code></li>
</ul>
</li>
<li><em><strong>Step-6:</strong></em> View deployed services
<ul>
<li><code>kubectl get deployment</code></li>
</ul>
</li>
<li><em><strong>Step-7:</strong></em> Exponse deployed service using load blancer on port 8080
<ul>
<li><code>kubectl expose deployment hello-world-rest-api --type=LoadBalancer --port=8080</code></li>
</ul>
</li>
<li><em><strong>Step-8:</strong></em> List running service with details (IP, port, age etc.)
<ul>
<li><code>kubectl get services</code></li>
</ul>
</li>
<li><em><strong>Step-9:</strong></em> watch progress
<ul>
<li><code>kubectl get services --watch</code></li>
</ul>
</li>
<li><em><strong>Step-10:</strong></em> Hit service
<ul>
<li><code>curl 35.184.204.214:8080/hello-world</code></li>
</ul>
</li>
<li><strong>Enable google cloud shell:</strong>
<ul>
<li><code>https://shell.cloud.google.com/?pli=1&amp;show=ide&amp;environment_deployment=ide</code></li>
</ul>
</li>
<li><strong>Note:</strong>
<ul>
<li><strong>Services</strong> are set of pods with a network endpoint that can be used for discovery and load balancing.</li>
<li><strong>Ingress</strong> are collection of rules for routing external HTTP(S) trafic to servies.
<ul>
<li>Using ingress we can create one load balacer for multiple services.</li>
<li>It can route requests to load balancers and Node ports.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Commands:</strong><pre><code class="language-sh">  
  <span class="hljs-comment"># initalize the sdk</span>
  <span class="hljs-comment"># Requires login to GCP account.</span>
  gcloud init

  <span class="hljs-comment"># If using gcloud local installation</span>
  <span class="hljs-comment"># login to GCP account</span>
  gcloud auth login

  <span class="hljs-comment"># Connect to gcloud-shell</span>
  <span class="hljs-comment"># It will generate and store a local ssh file for future logins</span>
  gcloud cloud-shell ssh

  <span class="hljs-comment"># Automatic authentication with GCP CLI tools in Cloud Shell is disabled. To enable, rerun above command with `--authorize-session` flag.</span>
  gcloud cloud-shell --authorize-session ssh

  <span class="hljs-comment"># set project using project id-operating-ally-446306-t7</span>
  <span class="hljs-comment"># Check project info for &#x27;project-id&#x27;</span>
  gcloud config <span class="hljs-built_in">set</span> project operating-ally-446306-t7

  <span class="hljs-comment"># Fetch cluster auth data and configures cluster</span>
  gcloud container clusters get-credentials my-standard-cluster-1 --zone us-central1-c --project operating-ally-446306-t7
  
  <span class="hljs-comment"># Deploy microservices</span>
  kubectl create deployment hello-world-rest-api --image=in28min/hello-world-rest-api:0.0.1.RELEASE
  
  <span class="hljs-comment"># View deployed services</span>
  kubectl get deployment
  
  <span class="hljs-comment"># View deployment info for specific deployment</span>
  kubectl get deployment currency-exchange-service

  <span class="hljs-comment"># view the deployment config in yaml format</span>
  kubectl get deployment currency-exchange-service -o yaml

  <span class="hljs-comment"># Exponse deployed service using load blancer (stable service IP) on port 8080</span>
  kubectl expose deployment hello-world-rest-api --<span class="hljs-built_in">type</span>=LoadBalancer --port=8080

  <span class="hljs-comment"># List running service with details (IP, port, age etc.)</span>
  kubectl get services

  <span class="hljs-comment"># View service info for specific deployment</span>
  kubectl get services currency-exchange-service

  <span class="hljs-comment"># view the deployment config in yaml format</span>
  kubectl get services currency-exchange-service -o yaml

  <span class="hljs-comment">#watch progress</span>
  kubectl get services --watch
  
  <span class="hljs-comment"># hit service</span>
  curl 35.184.204.214:8080/hello-world
  
  <span class="hljs-comment"># get list of events for the cluster</span>
  kubectl get events

  <span class="hljs-comment"># Scale the service deployement to 3 PODs</span>
  kubectl scale deployment hello-world-rest-api --replicas=3
  
  <span class="hljs-comment"># List all the PODs</span>
  kubectl get pod

  <span class="hljs-comment"># Mnual scaling</span>
  <span class="hljs-comment"># Default cluster pool has only 3 nodes.</span>
  <span class="hljs-comment"># If we need more pods then we need to scale-up our cluster</span>
  gcloud container clusters resize my-standard-cluster-1 --node-pool default-pool --num-nodes=2 --zone=us-central1-c
  
  <span class="hljs-comment"># Horizontal Auto scaling microservice</span>
  <span class="hljs-comment"># It can scale only upto number of nodes present in cluster.</span>
  kubectl autoscale deployment hello-world-rest-api --max=4 --cpu-percent=70

  <span class="hljs-comment"># Details of HPA - Horizontal pod autoscaling</span>
  kubectl get hpa

  <span class="hljs-comment"># delete hpa</span>
  kubectl delete hpa hello-world-rest-api

  <span class="hljs-comment"># cluster auto scaling</span>
  gcloud container cluster update my-standard-cluster-1 --enable-autoscaling --min-nodes=1 --max-nodes=10

  <span class="hljs-comment"># Config Map</span>
  <span class="hljs-comment"># Configuration to database or something like that</span>
  kubectl create configmap hello-world-config --from-literal=RDS_DB_NAME=todos
  
  <span class="hljs-comment"># list configs present</span>
  kubectl get configmap

  <span class="hljs-comment"># Show data in config map</span>
  kubectl describe configmap hello-world-config
  
  <span class="hljs-comment"># Store secrets / password in config map</span>
  <span class="hljs-comment"># Secret is stores as &#x27;Opaque&#x27; type</span>
  kubectl create secret generic hello-world-secrets-1 --from-literal=RDS_PASSWORD=dummytodos
  kubectl get secret
  kubectl describe secret hello-world-secrets-1
  
  <span class="hljs-comment"># Update/deploy cluster using yaml definition</span>
  kubectl apply -f deployment.yaml
  
  <span class="hljs-comment"># Create new node-pool</span>
  gcloud container node-pools create my-new-pool --cluster=my-standard-cluster-1 --zone=us-central1-c

  <span class="hljs-comment"># Delete nodes from node-pool</span>
  gcloud container node-pools delete my-new-pool --cluster=my-standard-cluster-1 --zone=us-central1-c

  <span class="hljs-comment"># list node pools details (name, disk-size, machine-type, node-version)</span>
  gcloud container node-pools list --zone=us-central1-c --cluster=my-standard-cluster-1
  
  <span class="hljs-comment"># get detailed status of pods - Name, status, containers, restart, IP, age etc.</span>
  kubectl get pods -o wide
  
  <span class="hljs-comment"># Update / Set a new image for running deployement / microservice</span>
  <span class="hljs-comment"># This will automatically deploy the new image with &#x27;0 downtime&#x27;.</span>
  kubectl <span class="hljs-built_in">set</span> image deployment hello-world-rest-api hello-world-rest-api=in28min/hello-world-rest-api:0.0.2.RELEASE
  
  <span class="hljs-comment"># list services replicasets &amp; pods</span>
  kubectl get services
  kubectl get replicasets
  kubectl get pods
  
  <span class="hljs-comment"># delete pod</span>
  kubectl delete pod hello-world-rest-api-58dc9d7fcc-8pv7r
  
  <span class="hljs-comment"># Set desired cound of Pods in the replica-set</span>
  kubectl scale deployment hello-world-rest-api --replicas=1
  
  <span class="hljs-comment"># List projects</span>
  gcloud projects list
  
  <span class="hljs-comment"># delete ervice</span>
  kubectl delete service hello-world-rest-api
  
  <span class="hljs-comment"># delete deployment</span>
  kubectl delete deployment hello-world-rest-api
  
  <span class="hljs-comment"># Delete all services related to a service - pods, service replicasets &amp; deployment.apps</span>
  kubectl delete all -l app=currency-exchange-service

  <span class="hljs-comment"># delete cluster</span>
  gcloud container clusters delete my-standard-cluster-1 --zone us-central1-c 

  <span class="hljs-comment"># check logs of a POD</span>
  kubectl logs currency-exchange-service-5bf8dd7984-p7tmm

  <span class="hljs-comment"># follow / tail logs of a POD</span>
  kubectl logs -f currency-exchange-service-5bf8dd7984-p7tmm

</code></pre>
</li>
</ul>
</li>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://github.com/springdoc/springdoc-openapi/blob/main/springdoc-openapi-starter-webmvc-ui/pom.xml">https://github.com/springdoc/springdoc-openapi/blob/main/springdoc-openapi-starter-webmvc-ui/pom.xml</a></li>
<li><a href="https://cloud.google.com/sdk/gcloud/reference/cloud-shell">https://cloud.google.com/sdk/gcloud/reference/cloud-shell</a></li>
<li><a href="https://cloud.google.com/sdk/gcloud/reference/cloud-shell/scp">https://cloud.google.com/sdk/gcloud/reference/cloud-shell/scp</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-gcp---install-gcloud-locally">4. GCP - Install gcloud locally</h2>
<ul>
<li><strong><ins>About / Introduction</ins></strong>
<ul>
<li>This is abc feature.</li>
<li>This is xyz feature.</li>
</ul>
</li>
<li><strong><ins>Steps</ins></strong>
<ul>
<li><em><strong>Project Setup:</strong></em> Requires <strong>kubectl</strong>.
<ul>
<li>Follow <code>Section 1</code> for instructions.</li>
</ul>
</li>
<li><em><strong>Step-1:</strong></em> Download <em><strong>Google Cloud SDK</strong></em> and follow instructions on website to instal it.</li>
<li><em><strong>Step-2:</strong></em> Download <em><strong>kubectl</strong></em> executable and follow instructions on website to install it.</li>
<li><em><strong>Step-3:</strong></em> Install <code>gke-gcloud-auth-plugin</code> required to use <code>kubectl</code> with <code>gcloud</code>.
<ul>
<li><code>gcloud components install gke-gcloud-auth-plugin</code></li>
</ul>
</li>
<li><em><strong>Step-4:</strong></em> Initialize gcloud <code>gcloud init</code> to initialize the sdk.</li>
<li><em><strong>Step-5:</strong></em> Authorize with GCP account. <code>gcloud auth login</code>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: Install the SDK where user level access are granted. Don't use root user / sudo.</p>
</blockquote>
<ul>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://cloud.google.com/sdk/docs/install">https://cloud.google.com/sdk/docs/install</a></li>
<li><a href="https://cloud.google.com/sdk/docs/uninstall-cloud-sdk">https://cloud.google.com/sdk/docs/uninstall-cloud-sdk</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="5-deploy-application-using-kubernetes">5. Deploy application using kubernetes</h2>
<h3 id="project-ref">Project ref:</h3>
<ul>
<li>
<p><em>e2-currency-exchange-service-kubernetes</em> &amp;</p>
</li>
<li>
<p><em>e3-currency-conversion-service-openfeign-kubernetes</em></p>
</li>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>Deploy microservices in GKE from local using <code>gcloud CLI</code> and <code>kubectl</code> commands.</li>
</ul>
</li>
<li>
<p><strong><ins>Steps</ins></strong></p>
<ul>
<li><em><strong>Project Setup:</strong></em> POM.xml: Remove following dependencies as <code>kubernetes</code> provide inbuild support for these funcationalities.
<ul>
<li>Eureka client</li>
<li>config client</li>
</ul>
</li>
<li><em><strong>Step-1:</strong></em> <em>Feign proxy:</em> Update feign client to use url property to define service URL.
<ul>
<li><code>@FeignClient(name = &quot;E2-CURRENCY-EXCHANGE-SERVICE-KUBERNETES&quot;, url = &quot;${CURRENCY_EXCHANGE_SERVICE_HOST:http://localhost}:8000&quot;)</code></li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> <em>application.properties</em> Add management properties to enable monitoring.</li>
<li><em><strong>Step-3:</strong></em> gcloud setup
<ul>
<li><code>gcloud auth login</code></li>
<li><code>gcloud container clusters get-credentials my-standard-cluster-1 --zone us-central1-c --project operating-ally-446306-t7</code></li>
</ul>
</li>
<li>Cretae deployment(Deploy services) using following command
<ul>
<li><code>kubectl create deployment currency-exchange-service --image=srvivek/e2-currency-exchange-service-kubernetes:0.0.11-SNAPSHOT</code></li>
<li><code>kubectl create deployment currency-conversion-service --image=srvivek/e3-currency-conversion-service-openfeign-kubernetes:0.0.11-SNAPSHOT</code></li>
</ul>
</li>
<li><em><strong>Step-4:</strong></em> Set currency exchange host name using env. prop. to be used in feign.
<ul>
<li><code>kubectl set env deployment/currency-conversion-service CURRENCY_EXCHANGE_SERVICE_HOST=currency-exchange-service</code>
<ul>
<li><strong>Imp.:</strong> Check notes for default host property available in kubernetes.</li>
</ul>
</li>
</ul>
</li>
<li><em><strong>Step-5:</strong></em> List env set for all pods
<ul>
<li><code>kubectl set env pods --all --list</code></li>
</ul>
</li>
<li><em><strong>Step-6:</strong></em> Exponse deployed service using load blancer service.
<ul>
<li><code>kubectl expose deployment currency-exchange-service --type=LoadBalancer --port=8000</code></li>
<li><code>kubectl expose deployment currency-conversion-service --type=LoadBalancer --port=8100</code></li>
</ul>
</li>
<li><em><strong>Step-7:</strong></em> Lets download the deployment and service config in yaml
<ul>
<li><strong>Deployment</strong> <code>kubectl get deployment currency-exchange-service -o yaml &gt;&gt; deployment.yaml</code></li>
<li><strong>Service:</strong> <code>kubectl get services currency-exchange-service -o yaml &gt;&gt; services.yaml</code></li>
</ul>
</li>
<li><em><strong>Step-8:</strong></em> We can change the yaml config as per requirement and deploy to upadate it on GKE.
<ul>
<li><strong>Difference:</strong> <code>kubectl diff -f deployment.yaml</code></li>
<li><strong>Deploy:</strong> <code>kubectl apply -f deployment.yaml</code></li>
</ul>
</li>
<li><em><strong>Step-9:</strong></em> Verify pods and run test to verify load balancer
<ul>
<li><code>watch -n 0.1 curl http://34.44.230.142:8100/currency-conversion-feign/from/UsD/to/iNr/quantity/100</code></li>
</ul>
</li>
<li><strong>Step-10:</strong> Cleaning generated config yaml.
<ul>
<li>check <code>deployment.yaml</code> code in below section.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>Code / Config changes</ins></strong></p>
<ul>
<li><strong>Feign proxy:</strong> <em>CurrencyExchangeProxy.java</em>
<ul>
<li>imports
<ul>
<li><code>import org.springframework.cloud.openfeign.FeignClient;</code></li>
</ul>
</li>
<li>Annotate the method parameter for validation.</li>
</ul>
<pre><code class="language-java">  <span class="hljs-meta">@FeignClient(name = &quot;E2-CURRENCY-EXCHANGE-SERVICE-KUBERNETES&quot;, url = &quot;${CURRENCY_EXCHANGE_SERVICE_HOST:http://localhost}:8000&quot;)</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CurrencyExchangeProxy</span> {

    <span class="hljs-comment">/**
    * Method as defined in the host service.
    * <span class="hljs-doctag">@param</span> from
    * <span class="hljs-doctag">@param</span> to
    * <span class="hljs-doctag">@return</span>
    */</span>
    <span class="hljs-meta">@GetMapping(&quot;/jpa/currency-exchange/from/{from}/to/{to}&quot;)</span>
    <span class="hljs-keyword">public</span> CurrencyConversion <span class="hljs-title function_">retrieveExchangeRateFromDatabase</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String from, <span class="hljs-meta">@PathVariable</span> String to)</span>;

  }
</code></pre>
</li>
<li><strong>Application Config:</strong> <em>application.properties</em><pre><code class="language-properties">  <span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">e3-currency-conversion-service-ofeign-kubernetes</span>
  <span class="hljs-attr">server.port</span>=<span class="hljs-string">8100</span>
<span class="hljs-comment">
  # Start: CHANGE-KUBERNETES</span>
  <span class="hljs-attr">management.endpoint.health.probes.enabled</span>=<span class="hljs-string">true</span>
  <span class="hljs-attr">management.health.livenessstate.enabled</span>=<span class="hljs-string">true</span>
  <span class="hljs-attr">management.health.readinessstate.enabled</span>=<span class="hljs-string">true</span>
<span class="hljs-comment">  # End: CHANGE-KUBERNETES</span>
<span class="hljs-comment">
  # Start: Spring Load Balancer</span>
<span class="hljs-comment">  # Enable load balancer.</span>
  <span class="hljs-attr">spring.cloud.loadbalancer.enabled</span>=<span class="hljs-string">true</span>
<span class="hljs-comment">
  # Enables LoadBalancer retries.</span>
  <span class="hljs-attr">spring.cloud.loadbalancer.retry.enabled</span>=<span class="hljs-string">true</span>
<span class="hljs-comment">  # End: Spring Load Balancer</span>
</code></pre>
</li>
<li><strong>Kubernetes declarative deployment:</strong> <em>deployment.yaml</em><pre><code class="language-yaml">  <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
  <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
  <span class="hljs-attr">metadata:</span>
    <span class="hljs-attr">annotations:</span>
      <span class="hljs-attr">deployment.kubernetes.io/revision:</span> <span class="hljs-string">&quot;1&quot;</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">spec:</span>
    <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># 2 instances should be available</span>
    <span class="hljs-attr">selector:</span>
      <span class="hljs-attr">matchLabels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">rollingUpdate:</span>
        <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span>
        <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span>
    <span class="hljs-attr">template:</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
      <span class="hljs-attr">spec:</span>
        <span class="hljs-attr">containers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">srvivek/e2-currency-exchange-service-kubernetes:0.0.11-SNAPSHOT</span>
          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">e2-currency-exchange-service-kubernetes</span>
        <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span>
  <span class="hljs-string">---</span>
  <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
  <span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
  <span class="hljs-attr">metadata:</span>
    <span class="hljs-attr">annotations:</span>
      <span class="hljs-attr">cloud.google.com/neg:</span> <span class="hljs-string">&#x27;{&quot;ingress&quot;:true}&#x27;</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">spec:</span>
    <span class="hljs-attr">allocateLoadBalancerNodePorts:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span>
      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8000</span>
    <span class="hljs-attr">selector:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
    <span class="hljs-attr">sessionAffinity:</span> <span class="hljs-string">None</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Notes:</ins></strong></p>
<ul>
<li>When a deployment is created, kubernetes automatically creates service host property.
<ul>
<li><code>&lt;DEPLOYMENT_SERVICE_NAME&gt;_SERVICE_HOST</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>App links:</ins></strong></p>
<ul>
<li><a href="https://hub.docker.com/repository/create?namespace=srvivek">https://hub.docker.com/repository/create?namespace=srvivek</a></li>
</ul>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubectl/generated/kubectl_set/kubectl_set_env/">https://kubernetes.io/docs/reference/kubectl/generated/kubectl_set/kubectl_set_env/</a></li>
<li></li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-google-cloud-logging-tracing-and-monitoring">6. Google Cloud: Logging, Tracing and Monitoring</h2>
<ul>
<li><strong><ins>About / Introduction</ins></strong>
<ul>
<li>Centerlized logs for the all services/containers/pods etc.</li>
<li>Centerlized monitoring for all services/containers/pods etc.</li>
</ul>
</li>
<li><strong><ins>Steps</ins></strong>
<ul>
<li><em><strong>Project Setup:</strong></em> Ensure micrometer dependencies are available in latest image.</li>
<li><em><strong>Step-1:</strong></em> Enable logging and tracing in GCP.
<ul>
<li>Navigate to API and Services in GKE, goto <code>API Library</code>.</li>
<li>Search and open below services.
<ul>
<li><code>cloud logging API</code></li>
<li><code>Stackdriver API</code></li>
</ul>
</li>
<li>If not enabled, Click on <code>Manage</code> and</li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> Fire requests (10/sec) to generate logs in system.
<ul>
<li><code>watch -n 0.1 curl http://34.42.22.155:8100/currency-conversion-feign/from/UsD/to/iNr/quantity/100</code></li>
</ul>
</li>
<li><em><strong>Step-3:</strong></em> Now go to cluster in GCP, open the cluster link.
<ul>
<li>Go below to <code>Features section</code> and click on:
<ul>
<li><code>View logs</code> - To check logs.
<ul>
<li>By default logs filter is set on <code>cluster</code>, clear this.</li>
<li>Click on <code>Kubernetes containers</code> in filter and select desired <code>pod</code>.
<ul>
<li>You also select different options from filter, e.g. - cluster, service, container etc.</li>
</ul>
</li>
</ul>
</li>
<li><code>View GKE Dashboard</code> - For Cloud monitoring.</li>
</ul>
</li>
</ul>
</li>
<li><em><strong>Logs Explorer:</strong></em>
<ul>
<li>We can add conditions in the query panel to filter the logs.</li>
<li>We can also use id's from log entries to find all logs to that id from query panel.
<ul>
<li>E.g. <code>resource.type=&quot;k8s_container&quot; textPayload:&quot;a0f973a78782bd1ec580c444fda324c1&quot;</code></li>
</ul>
</li>
</ul>
</li>
<li><em><strong>GKE Dashboard:</strong></em>
<ul>
<li>All matrics for sytem monitoring and resource utilization for cluster, namespaces, Nodes, workloads, services, pods, containers etc.
<ul>
<li>eg. CPU, Memory &amp; Disk Utilization.</li>
<li>Containers restart, error logs etc.</li>
</ul>
</li>
<li>Provides alert service.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: Ensure following dependencies are present in POM.</p>
</blockquote>
<ul>
<li>
<p>implementation platform('io.micrometer:micrometer-tracing-bom:latest.release')</p>
</li>
<li>
<p>implementation 'io.micrometer:micrometer-tracing'</p>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://micrometer.io/docs/tracing">https://micrometer.io/docs/tracing</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="7-google-cloud-gke-configmap---centralized-configuration">7. Google Cloud: GKE ConfigMap - Centralized Configuration</h2>
<ul>
<li><strong><ins>About / Introduction</ins></strong>
<ul>
<li>Provides centerlize configuration.</li>
<li>A ConfigMap is an API object used to store non-confidential data in key-value pairs.</li>
<li>Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume.
<ul>
<li><strong>Caution:</strong>
<ul>
<li>ConfigMap does not provide secrecy or encryption. If the data you want to store are confidential, use a Secret rather than a ConfigMap, or use additional (third party) tools to keep your data private.</li>
<li>The spec of a static Pod cannot refer to a ConfigMap or any other API objects.</li>
</ul>
</li>
<li><strong>Note:</strong>
<ul>
<li>A ConfigMap is not designed to hold large chunks of data. The data stored in a ConfigMap cannot exceed 1 MiB.</li>
<li>If you need to store settings that are larger than this limit, you may want to consider mounting a volume or use a separate database or file service.</li>
</ul>
</li>
</ul>
</li>
<li>A ConfigMap allows you to decouple environment-specific configuration from your container images, so that your applications are easily portable.</li>
<li>A ConfigMap has data and binaryData fields. These fields accept key-value pairs as their values.
<ul>
<li>Both the data field and the binaryData are optional.</li>
<li>The data field is designed to contain UTF-8 strings while the binaryData field is designed to contain binary data as base64-encoded strings.</li>
</ul>
</li>
<li>The name of a ConfigMap must be a valid <code>DNS subdomain name</code>.</li>
</ul>
</li>
<li><strong><ins>Steps</ins></strong>
<ul>
<li><em><strong>Project Setup:</strong></em> GKE has microservices running.</li>
<li><em><strong>Step-1:</strong></em> Create a configMap.
<ul>
<li><code>kubectl create configmap currency-conversion-service-openfeign --from-literal=CURRENCY_EXCHANGE_URI=http://currency-exchange-service</code></li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> Verify / list the config map
<ul>
<li><code>kubectl get configmap currency-conversion-service-openfeign</code></li>
<li><code>kubectl get configmap currency-conversion-service-openfeign -o yaml</code></li>
</ul>
</li>
<li><em><strong>Step-3:</strong></em> We can add the config map content in our <code>deloyment.yaml</code> file.
<ul>
<li>Add <code>envFrom</code> declaration in <code>containers</code> to read data from <code>configmap</code>.</li>
<li>Remove <code>env</code> declaration from <code>containers</code>.</li>
<li><strong>New File:</strong> <em>deployment-0-3-with-configmap.yaml</em></li>
</ul>
</li>
<li><em><strong>Step-4:</strong></em> Apply the new configuration.
<ul>
<li><strong>Difference:</strong>
<ul>
<li><code>kubectl diff -f deployment-0-3-with-configmap.yaml</code></li>
</ul>
</li>
<li><strong>Apply:</strong>
<ul>
<li><code>kubectl apply -f deployment-0-3-with-configmap.yaml</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: <em><strong>Must</strong></em> veriy the difference before applying the update yaml file. I also helps to validate yaml by throwing error, if there's any syntactical mistakes.</p>
</blockquote>
<ul>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/configuration/configmap/">https://kubernetes.io/docs/concepts/configuration/configmap/</a></li>
<li></li>
</ul>
</li>
</ul>
<hr>
<h2 id="8-kubernetes--exploring-deployments---liveness-and-readiness-probes">8. Kubernetes : Exploring deployments - Liveness and Readiness probes</h2>
<ul>
<li>
<p><strong><ins>About / Introduction</ins></strong></p>
<ul>
<li><strong>Liveness Probes:</strong>
<ul>
<li>The kubelet uses liveness probes to check health of a microservice and/or to restart POD if liveness probe is not successful.
<ul>
<li>For example, liveness probes could catch a deadlock, where an application is running, but unable to make progress. Restarting a container in such a state can help to make the application more available despite bugs.</li>
</ul>
</li>
<li>A common pattern for liveness probes is to use the same low-cost HTTP endpoint as for readiness probes, but with a higher failureThreshold. This ensures that the pod is observed as not-ready for some period of time before it is hard killed.</li>
<li><strong>Caution:</strong>
<ul>
<li>Liveness probes can be a powerful way to recover from application failures, but they should be used with caution.</li>
<li>Liveness probes must be configured carefully to ensure that they truly indicate unrecoverable application failure, for example a deadlock.</li>
</ul>
</li>
<li><strong>Note:</strong>
<ul>
<li>Incorrect implementation of liveness probes can lead to cascading failures. This results in restarting of container under high load; failed client requests as your application became less scalable; and increased workload on remaining pods due to some failed pods.</li>
<li>Understand the difference between readiness and liveness probes and when to apply them for your app.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Readiness Probes:</strong>
<ul>
<li>The kubelet uses readiness probes to know when a container is ready to start accepting traffic. One use of this signal is to control which Pods are used as backends for Services.
<ul>
<li>A Pod is considered ready when its Ready condition is true. When a Pod is not ready, it is removed from Service load balancers. A Pod's Ready condition is false when its Node's Ready condition is not true, when one of the Pod's readinessGates is false, or when at least one of its containers is not ready.</li>
</ul>
</li>
<li><em><strong>If <code>Readiness probe</code> is not succesfull. no traffic is sent.</strong></em></li>
</ul>
</li>
<li><strong>Startup Probes:</strong>
<ul>
<li>The kubelet uses startup probes to know when a container application has started. If such a probe is configured, liveness and readiness probes do not start until it succeeds, making sure those probes don't interfere with the application startup.
<ul>
<li>This can be used to adopt liveness checks on slow starting containers, avoiding them getting killed by the kubelet before they are up and running.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Springboot Actuator:</strong> Springboot Actuator (&gt;=2.3) provides inbuild readiness and liveness probes.
<ul>
<li><code>actuator/health/readiness</code></li>
<li><code>actuator/health/liveness</code></li>
</ul>
</li>
<li></li>
</ul>
</li>
<li>
<p><strong><ins>Steps</ins></strong></p>
<ul>
<li><em><strong>Project Setup:</strong></em> Microservices running in GKE.</li>
<li><em><strong>Step-1:</strong></em> Get rollout history/revisions of specific deployment.
<ul>
<li><code>kubectl rollout history deployment currency-conversion-service-openfeign</code></li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> In case of any error occurs during deployment. We can always rollback to old working revision.
<ul>
<li><code>kubectl rollout undo deployment currency-conversion-service-openfeign --to-revision=2</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>deployment.yaml</ins></strong></p>
<ul>
<li>Liveness and Readiness probes updated in deployment decaration.</li>
</ul>
<pre><code class="language-yaml">      <span class="hljs-comment"># ... other config</span>
      <span class="hljs-attr">template:</span>
        <span class="hljs-attr">metadata:</span>
          <span class="hljs-attr">labels:</span>
            <span class="hljs-attr">app:</span> <span class="hljs-string">currency-exchange-service</span>
        <span class="hljs-attr">spec:</span>
          <span class="hljs-attr">containers:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">srvivek/e2-currency-exchange-service-kubernetes:0.0.11-SNAPSHOT</span>
            <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">e2-currency-exchange-service-kubernetes</span>
            <span class="hljs-attr">readinessProbe:</span>
              <span class="hljs-attr">httpGet:</span>
                <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span>
                <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/readiness</span>
            <span class="hljs-attr">livenessProbe:</span>
              <span class="hljs-attr">httpGet:</span>
                <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span>
                <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/liveness</span>
          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span>
      <span class="hljs-comment"># ... other config</span>
</code></pre>
</li>
</ul>
<blockquote>
<p>Note: Readiness and Liveness probes help to increase high availability of our application.</p>
</blockquote>
<ul>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="9-kubernetes-horizontal-autoscaling-microservices">9. Kubernetes: Horizontal Autoscaling microservices</h2>
<ul>
<li>
<p><strong><ins>About / Introduction</ins></strong></p>
<ul>
<li><strong>Types:</strong>
<ul>
<li><em>Horizonal</em></li>
</ul>
</li>
<li><strong>Horizontal:</strong>
<ul>
<li>In Kubernetes, a <em>HorizontalPodAutoscaler</em> automatically updates a workload resource (such as a Deployment or StatefulSet), with the aim of automatically scaling the workload to match demand.</li>
<li>Horizontal scaling means that the response to increased load is to deploy more Pods.
<ul>
<li>This is different from vertical scaling, which for Kubernetes would mean assigning more resources (for example: memory or CPU) to the Pods that are already running for the workload.</li>
</ul>
</li>
<li>If the load decreases, and the number of Pods is above the configured minimum, the HorizontalPodAutoscaler instructs the workload resource (the Deployment, StatefulSet, or other similar resource) to scale back down.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>Steps</ins></strong></p>
<ul>
<li><em><strong>Project Setup:</strong></em> Microservices running kubernetes cluster.</li>
<li><em><strong>Step-1:</strong></em> Manual autoscaling
<ul>
<li><code>kubectl autoscale deployment currency-conversion-service-openfeign --min=1 --max=3 --cpu-percent=5</code></li>
</ul>
</li>
<li><em><strong>Step-2:</strong></em> list horizonal autoscaling
<ul>
<li><code>kubectl get hpa</code></li>
<li><code>kubectl get hpa -o yaml</code></li>
</ul>
</li>
<li><em><strong>Step-3:</strong></em> See the CPU / Memory utilization.
<ul>
<li><code>kubectl top pods</code></li>
<li><code>kubectl top nodes</code></li>
</ul>
</li>
<li><em><strong>Step-4:</strong></em> Verify pods by increasing traffice on load.</li>
</ul>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/autoscaling/">https://kubernetes.io/docs/concepts/workloads/autoscaling/</a></li>
<li><a href="https://kubernetes.io/docs/reference/kubectl/generated/kubectl_autoscale/">https://kubernetes.io/docs/reference/kubectl/generated/kubectl_autoscale/</a></li>
</ul>
</li>
</ul>
<hr>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>